import{r as u,s as y,t as F,f as g,aa as E,av as W,v as P,X as p,Z as j,_ as Y,l as $,h as b,H as X,bj as ee,bk as te,c as h,w as N,C as ae,D as le,S as re,o as Z,ah as ne,I as oe,aw as ie,bl as Q,n as H,ax as q,bd as A,as as se,bm as O,aH as ue,g as ce,i as G,a0 as fe,F as de,a4 as ve,$ as me,a5 as ge,p as R}from"./index.ef28cfcc.js";import{_ as be}from"./FilterInput.8d262002.js";import{b as he,Q as z,a as U}from"./position-engine.a753418a.js";import{I as pe}from"./ItemIcon.11d1a9c7.js";import{Q as _e}from"./QList.b9894bb9.js";import{Q as ye}from"./QScrollArea.65f95583.js";import{api as xe}from"./axios.c040a620.js";import{l as Se,n as Le}from"./myFuncts.bc1bbbc0.js";import{u as Ce}from"./use-quasar.5324f940.js";import"./selection.e0a85ebc.js";import"./QScrollObserver.ac6fd869.js";import"./TouchPan.f4f61c8d.js";import"./format.865294d5.js";import"./jwt-decode.esm.81f958e7.js";const De={class:"navigator"},Ie={__name:"CategoryNavigator",props:{filters:u(null)},setup(l){const o=u(l.filters);return(c,r)=>(y(),F("div",De,[g(E,{label:"\u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0435",modelValue:o.value.personal,"onUpdate:modelValue":r[0]||(r[0]=i=>o.value.personal=i)},null,8,["modelValue"]),g(E,{label:"\u041D\u0435 \u043F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0435",modelValue:o.value.public,"onUpdate:modelValue":r[1]||(r[1]=i=>o.value.public=i)},null,8,["modelValue"]),g(E,{label:"\u041A\u0440\u0430\u0444\u0442\u0430\u0431\u0435\u043B\u044C\u043D\u044B\u0435",disable:!o.value.personal&&!o.value.public,modelValue:o.value.craftable,"onUpdate:modelValue":r[2]||(r[2]=i=>o.value.craftable=i)},null,8,["disable","modelValue"]),g(E,{label:"\u041D\u0435 \u043A\u0440\u0430\u0444\u0442\u0430\u0431\u0435\u043B\u044C\u043D\u044B\u0435",disable:!o.value.personal&&!o.value.public,modelValue:o.value.uncraftable,"onUpdate:modelValue":r[3]||(r[3]=i=>o.value.uncraftable=i)},null,8,["disable","modelValue"]),g(be)]))}};var Ne=W(Ie,[["__scopeId","data-v-3fadaf37"]]);const we={__name:"ItemRow",props:{item:u(null)},setup(l){return(d,o)=>(y(),P(he,{tag:"label",to:"/item/"+l.item.id},{default:p(()=>[g(z,{avatar:""},{default:p(()=>[g(pe,{icon:l.item.icon,grade:l.item.grade},null,8,["icon","grade"])]),_:1}),g(z,null,{default:p(()=>[g(U,null,{default:p(()=>[j(Y(l.item.name),1)]),_:1}),l.item.personal?(y(),P(U,{key:0,caption:""},{default:p(()=>[j(" \u041F\u0435\u0440\u0441\u043E\u043D\u0430\u043B\u044C\u043D\u044B\u0439 ")]),_:1})):$("",!0),l.item.craftable?(y(),P(U,{key:1,caption:""},{default:p(()=>[j(" \u041A\u0440\u0430\u0444\u0442\u0430\u0431\u0435\u043B\u044C\u043D\u044B\u0439 ")]),_:1})):$("",!0)]),_:1})]),_:1},8,["to"]))}},Ve=[b("circle",{cx:"15",cy:"15",r:"15"},[b("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),b("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})]),b("circle",{cx:"60",cy:"15",r:"9","fill-opacity":".3"},[b("animate",{attributeName:"r",from:"9",to:"9",begin:"0s",dur:"0.8s",values:"9;15;9",calcMode:"linear",repeatCount:"indefinite"}),b("animate",{attributeName:"fill-opacity",from:".5",to:".5",begin:"0s",dur:"0.8s",values:".5;1;.5",calcMode:"linear",repeatCount:"indefinite"})]),b("circle",{cx:"105",cy:"15",r:"15"},[b("animate",{attributeName:"r",from:"15",to:"15",begin:"0s",dur:"0.8s",values:"15;9;15",calcMode:"linear",repeatCount:"indefinite"}),b("animate",{attributeName:"fill-opacity",from:"1",to:"1",begin:"0s",dur:"0.8s",values:"1;.5;1",calcMode:"linear",repeatCount:"indefinite"})])];var Pe=X({name:"QSpinnerDots",props:ee,setup(l){const{cSize:d,classes:o}=te(l);return()=>b("svg",{class:o.value,fill:"currentColor",width:d.value,height:d.value,viewBox:"0 0 120 30",xmlns:"http://www.w3.org/2000/svg"},Ve)}});const{passive:I}=ie;var Be=X({name:"QInfiniteScroll",props:{offset:{type:Number,default:500},debounce:{type:[String,Number],default:100},scrollTarget:{default:void 0},initialIndex:Number,disable:Boolean,reverse:Boolean},emits:["load"],setup(l,{slots:d,emit:o}){const c=u(!1),r=u(!0),i=u(null),x=u(null);let S=l.initialIndex||0,t,f;const T=h(()=>"q-infinite-scroll__loading"+(c.value===!0?"":" invisible"));function _(){if(l.disable===!0||c.value===!0||r.value===!1)return;const n=Q(t),s=q(t),m=O(t);l.reverse===!1?Math.round(s+m+l.offset)>=Math.round(n)&&w():Math.round(s)<=l.offset&&w()}function w(){if(l.disable===!0||c.value===!0||r.value===!1)return;S++,c.value=!0;const n=Q(t);o("load",S,s=>{r.value===!0&&(c.value=!1,H(()=>{if(l.reverse===!0){const m=Q(t),J=q(t),K=m-n;A(t,J+K)}s===!0?V():i.value&&i.value.closest("body")&&f()}))})}function C(){S=0}function D(){r.value===!1&&(r.value=!0,t.addEventListener("scroll",f,I)),_()}function V(){r.value===!0&&(r.value=!1,c.value=!1,t.removeEventListener("scroll",f,I),f!==void 0&&f.cancel!==void 0&&f.cancel())}function B(){if(t&&r.value===!0&&t.removeEventListener("scroll",f,I),t=se(i.value,l.scrollTarget),r.value===!0){if(t.addEventListener("scroll",f,I),l.reverse===!0){const n=Q(t),s=O(t);A(t,n-s)}_()}}function M(n){S=n}function k(n){n=parseInt(n,10);const s=f;f=n<=0?_:ue(_,isNaN(n)===!0?100:n),t&&r.value===!0&&(s!==void 0&&t.removeEventListener("scroll",s,I),t.addEventListener("scroll",f,I))}function e(n){if(a.value===!0){if(x.value===null){n!==!0&&H(()=>{e(!0)});return}const s=`${c.value===!0?"un":""}pauseAnimations`;Array.from(x.value.getElementsByTagName("svg")).forEach(m=>{m[s]()})}}const a=h(()=>l.disable!==!0&&r.value===!0);N([c,a],()=>{e()}),N(()=>l.disable,n=>{n===!0?V():D()}),N(()=>l.reverse,()=>{c.value===!1&&r.value===!0&&_()}),N(()=>l.scrollTarget,B),N(()=>l.debounce,k);let v=!1;ae(()=>{v!==!1&&t&&A(t,v)}),le(()=>{v=t?q(t):!1}),re(()=>{r.value===!0&&t.removeEventListener("scroll",f,I)}),Z(()=>{k(l.debounce),B(),c.value===!1&&e()});const L=ce();return Object.assign(L.proxy,{poll:()=>{f!==void 0&&f()},trigger:w,stop:V,reset:C,resume:D,setIndex:M}),()=>{const n=ne(d.default,[]);return a.value===!0&&n[l.reverse===!1?"push":"unshift"](b("div",{ref:x,class:T.value},oe(d.loading))),b("div",{class:"q-infinite-scroll",ref:i},n)}}});const ke={class:"row justify-center q-my-md"},Ee=50,Qe={__name:"ItemList",setup(l){const d=G("filteredList");Math.ceil(d.length/Ee),u(!1),u(2),u(0);const o=u(20);u([{},{},{},{},{},{},{}]);const c=h(()=>{var i;return(i=d.value)!=null&&i.length?d.value.slice(0,o.value):[]});function r(i,x){setTimeout(()=>{o.value+=20,x()},1)}return(i,x)=>(y(),P(ye,{class:"col myScrollArea"},{default:p(()=>[g(_e,{dense:"",separator:""},{default:p(()=>[g(Be,{onLoad:r,offset:100},fe({default:p(()=>[(y(!0),F(de,null,ve(c.value,(S,t)=>(y(),P(we,{key:t,item:S},null,8,["item"]))),128))]),_:2},[o.value<me(d).length?{name:"loading",fn:p(()=>[ge("div",ke,[g(Pe,{color:"primary",size:"40px"})])]),key:"0"}:void 0]),1024)]),_:1})]),_:1}))}};const Te={class:"WindowArea column"},Me={__name:"CategoryPage",setup(l){const d=Ce(),o=G("selCategId"),c=u("");R("searchText",c);const r=u(!1),i=u({craftable:!0,uncraftable:!0,personal:!0,public:!0});u(!1);const x=h(()=>i.value.personal?D.value.filter(a=>a.personal):[]),S=h(()=>i.value.public?D.value.filter(a=>!a.personal):[]),t=h(()=>{if(!D.value||!D.value.length)return[];let e=[];return e.push(...x.value),e.push(...S.value),e}),f=h(()=>i.value.craftable?t.value.filter(a=>a.craftable):[]),T=h(()=>i.value.uncraftable?t.value.filter(a=>!a.craftable):[]),_=h(()=>{if(!t.value||!t.value.length)return[];let e=[];return e.push(...f.value),e.push(...T.value),e}),w=h(()=>{if(!_.value||!_.value.length)return[];let e=_.value,a=Se(c.value);if(a!==""){let v=a.toLowerCase();e=e.filter(L=>L.name.toLowerCase().indexOf(v)!==-1)}return e});R("filteredList",w),Z(()=>{B()}),N(o,()=>{V()}),N(i.value,()=>{V()},{deep:!0});const C=u([]),D=h(()=>!C.value||!C.value.length?[]:[...C.value].filter(a=>a.categId===o.value));function V(){r.value=!0,H(()=>{r.value=!1})}function B(){let e=indexedDB.open("prepData",1);e.onupgradeneeded=function(){let a=e.result;a.objectStoreNames.contains("cachedData")||a.createObjectStore("cachedData",{keyPath:"id"})},e.onerror=function(){console.error("Error",e.error)},e.onsuccess=function(){let n=e.result.transaction("cachedData","readonly").objectStore("cachedData").get("searchList");n.onsuccess=s=>{let m=s.target.result;m?C.value=m.content:k()},n.onerror=s=>{console.log("SearchList \u043D\u0435 \u0441\u043E\u0445\u0440\u0430\u043D\u0435\u043D")}}}function M(e){let a=indexedDB.open("prepData",1);a.onupgradeneeded=function(){console.log("\u0438\u043D\u0438\u0446\u0438\u043B\u0438\u0430\u0437\u0438\u044F \u0431\u0434");let v=a.result;v.objectStoreNames.contains("cachedData")||v.createObjectStore("cachedData",{keyPath:"id"})},a.onerror=function(){console.error("Error",a.error)},a.onsuccess=function(){let v=a.result;console.log("\u0432\u0438\u0436\u0443 \u0431\u0434");let n=v.transaction("cachedData","readwrite").objectStore("cachedData"),s={id:"searchList",content:e},m=n.add(s);m.onsuccess=function(){console.log("\u0421\u043F\u0438\u0441\u043E\u043A \u0434\u043E\u0431\u0430\u0432\u043B\u0435\u043D \u0432 \u0445\u0440\u0430\u043D\u0438\u043B\u0438\u0449\u0435",m.result)},m.onerror=function(){console.log("\u041E\u0448\u0438\u0431\u043A\u0430",m.error)}}}function k(){xe.post(apiUrl+"api/get/search.php").then(e=>{var a,v,L,n,s;if(!((a=e==null?void 0:e.data)!=null&&a.result))throw new Error;M((L=(v=e==null?void 0:e.data)==null?void 0:v.data)!=null?L:[]),C.value=(s=(n=e==null?void 0:e.data)==null?void 0:n.data)!=null?s:[]}).catch(e=>{d.notify(Le(e,"\u041E\u0439! Search \u041D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 :("))})}return(e,a)=>(y(),F("div",Te,[g(Ne,{filters:i.value},null,8,["filters"]),w.value.length&&!r.value?(y(),P(Qe,{key:0})):$("",!0)]))}};var Je=W(Me,[["__scopeId","data-v-191dcc86"]]);export{Je as default};
