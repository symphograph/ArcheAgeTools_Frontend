import{i as x,r as f,c,J as r,n as T,t as L,K as te,G as l,f as a,N as pe,bk as D,H as P,I as F,l as Z,M as me,Q as U,P as S,b as le,bd as ae,L as fe,R as _e,p as z,w as ye,o as Ie,q as ne,ba as A,be as ge,b9 as W}from"./index.85a18687.js";import{Q as Pe}from"./QLinearProgress.87b14ffb.js";import{N as ke,Z as Se,a as be,S as ze}from"./SalaryCard.cb2f7682.js";import{api as X}from"./axios.84dd43a9.js";import{n as Y}from"./myFuncts.325243df.js";import{u as Fe}from"./use-quasar.bc7896a7.js";import{b as j,Q as C,a as h}from"./position-engine.fab5a7b7.js";import{Q as G}from"./QSelect.8eed0032.js";import{I as ee}from"./ItemIcon.23b1ef6d.js";import{_ as E}from"./plugin-vue_export-helper.21dcd24c.js";import"./QList.559d0f30.js";import"./PriceImagerComponent.79c11853.js";import"./price.2525409f.js";import"./selection.a1f2ef76.js";import"./QMenu.a0aa64e9.js";import"./format.959830d0.js";const he=["src"],xe={__name:"PackSelect",emits:["onSelect"],setup(N,{emit:I}){const d=x("loading"),_=x("ptSettings"),p=x("filteredPackList"),t=f([...p.value]),o=x("selectedPack"),y=x("selectOptionsStyle"),s=c(()=>{let g=y;return g?(g.width="10em",console.log(g),g):{}});f([]);const n=I;function $(g,m,i){if(g===""){m(()=>{t.value=[...p.value]});return}m(()=>{const k=g.toLowerCase();let v=[...p.value];g&&(v=[...v].filter(R=>R.Pack.name.toLowerCase().indexOf(k)>-1)),t.value=v})}function Q(){o.value=null,_.value.zoneFromId=0,_.value.zoneToId=0}return(g,m)=>r(p).length?(T(),L(G,{key:0,options:t.value,modelValue:r(o),"onUpdate:modelValue":[m[0]||(m[0]=i=>le(o)?o.value=i:null),m[1]||(m[1]=i=>n("onSelect"))],"popup-content-style":s.value,"popup-content-class":"popup",loading:r(d),disable:r(d),"label-slot":"","use-input":"","fill-input":"","map-options":"","item-aligned":"","option-value":"id","option-label":"name","hide-selected":"",onFilter:$},te({label:l(()=>[a(j,null,{default:l(()=>[a(C,null,{default:l(()=>[a(h,{caption:""},{default:l(()=>{var i,k,v;return[P(F((v=(k=(i=r(o))==null?void 0:i.ZoneFrom)==null?void 0:k.name)!=null?v:""),1)]}),_:1}),a(h,{caption:""},{default:l(()=>{var i,k,v;return[P(F((v=(k=(i=r(o))==null?void 0:i.ZoneTo)==null?void 0:k.name)!=null?v:""),1)]}),_:1})]),_:1})]),_:1})]),selected:l(()=>[Object.keys(r(o).value).length?(T(),L(j,{key:0,dense:""},{default:l(()=>[a(C,{avatar:""},{default:l(()=>m[2]||(m[2]=[P("\u043B\u043E\u0440\u043F\u043B ")])),_:1}),a(C,null,{default:l(()=>[a(h,null,{default:l(()=>[P(F(r(o).Pack.name),1)]),_:1}),a(h,{caption:""},{default:l(()=>[P(F(r(o).ZoneFrom.name),1)]),_:1}),a(h,{caption:""},{default:l(()=>[P(F(r(o).ZoneTo.name),1)]),_:1})]),_:1})]),_:1})):Z("",!0)]),option:l(i=>[a(j,me(i.itemProps,{dense:""}),{default:l(()=>[a(C,{avatar:""},{default:l(()=>[a(U,{size:"1.5em",style:{position:"absolute",top:"-0.3em",left:"0.5em","z-index":"99"}},{default:l(()=>[S("img",{src:"/img/packtypes/"+i.opt.Pack.typeId+".png",alt:""},null,8,he)]),_:2},1024),a(ee,{icon:i.opt.Pack.icon,grade:i.opt.Pack.grade,size:"60px"},null,8,["icon","grade"])]),_:2},1024),a(C,null,{default:l(()=>[a(h,{lines:"2"},{default:l(()=>[P(F(i.opt.Pack.name),1)]),_:2},1024),a(h,{caption:""},{default:l(()=>[P(F(i.opt.ZoneFrom.name),1)]),_:2},1024),a(h,{caption:""},{default:l(()=>[P(F(i.opt.ZoneTo.name),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[r(o)?{name:"prepend",fn:l(()=>[a(ee,{icon:r(o).Pack.icon,grade:r(o).Pack.grade,size:"60px"},null,8,["icon","grade"])]),key:"0"}:void 0,r(o)?{name:"append",fn:l(()=>[a(pe,{name:"cancel",onClick:D(Q,["stop","prevent"]),class:"cursor-pointer"})]),key:"1"}:void 0]),1032,["options","modelValue","popup-content-style","loading","disable"])):Z("",!0)}};var Te=E(xe,[["__scopeId","data-v-89ec258c"]]);const Ce={__name:"FreshSelect",setup(N){const I=x("selectedFresh"),d=x("selectedPack"),_=f("Input"),p=x("selectOptionsStyle");return(t,o)=>(T(),L(G,{options:r(d).Freshness.FreshLvls,"map-options":"","option-value":"lvl","option-label":"name",borderless:"",dense:"",modelValue:r(I),"onUpdate:modelValue":o[0]||(o[0]=y=>le(I)?I.value=y:null),class:ae(_.value),onFocus:o[1]||(o[1]=y=>_.value="Input InputActive"),onBlur:o[2]||(o[2]=y=>_.value="Input"),"popup-content-style":r(p)},{prepend:l(()=>[a(U,null,{default:l(()=>o[3]||(o[3]=[S("img",{src:"/img/time.png"},null,-1)])),_:1})]),_:1},8,["options","modelValue","class","popup-content-style"]))}};var Le=E(Ce,[["__scopeId","data-v-764a5c61"]]);const $e=["src"],Qe=["src"],Ze={__name:"SideSelect",emits:["selected"],setup(N,{emit:I}){const d=[{label:"\u0417\u0430\u043F\u0430\u0434",value:1},{label:"\u0421\u0435\u0432\u0435\u0440",value:3},{label:"\u0412\u043E\u0441\u0442\u043E\u043A",value:2}];function _(){const s=(d.findIndex(n=>n.value===t.value.side)+1)%d.length;t.value.side=d[s].value,o("selected")}const p=f("Input"),t=x("ptSettings"),o=I;return(y,s)=>(T(),L(G,{label:"\u041C\u0430\u0442\u0435\u0440\u0438\u043A",modelValue:r(t).side,"onUpdate:modelValue":[s[1]||(s[1]=n=>r(t).side=n),s[4]||(s[4]=n=>o("selected"))],options:d,borderless:"","map-options":"","emit-value":"","popup-content-style":{backgroundColor:"rgb(181 238 8 / 93%)",color:"#4B3A23"},class:ae(p.value),onFocus:s[2]||(s[2]=n=>p.value="Input InputActive"),onBlur:s[3]||(s[3]=n=>p.value="Input")},te({append:l(()=>[a(ke,{active:r(t).siol,imgBtn:"/img/siol.png",onClick:s[0]||(s[0]=D(n=>r(t).siol=!r(t).siol,["stop","prevent"]))},null,8,["active"])]),option:l(n=>[a(j,fe(_e(n.itemProps)),{default:l(()=>[a(C,{avatar:""},{default:l(()=>[a(U,null,{default:l(()=>[S("img",{src:"/img/side/"+n.opt.value+".png",alt:""},null,8,Qe)]),_:2},1024)]),_:2},1024),a(C,null,{default:l(()=>[a(h,null,{default:l(()=>[P(F(n.opt.label),1)]),_:2},1024)]),_:2},1024)]),_:2},1040)]),_:2},[r(t).side?{name:"prepend",fn:l(()=>[a(U,null,{default:l(()=>[S("img",{src:"/img/side/"+r(t).side+".png",alt:"",onClick:D(_,["stop","prevent"])},null,8,$e)]),_:1})]),key:"0"}:void 0]),1032,["modelValue","class"]))}};var Ve=E(Ze,[["__scopeId","data-v-5d11ce99"]]);const we={class:"paculatorArea"},Be={style:{display:"flex","justify-content":"space-evenly"}},Oe={__name:"PackCalculator",setup(N){const I=Fe(),d=String("https://aa.dllib.ru/be/"),_=f({}),p=f([]),t=f({zoneFromId:0,zoneToId:0,side:0,siol:!1,ratePercent:130});z("ptSettings",t);const o=c(()=>v.value);z("disabled",o);const y=c(()=>{if(!Object.keys(_.value).length||!t.value.side)return[{id:0,name:"\u0412\u0441\u0435"}];let e=[..._.value[t.value.side]];return e.unshift({id:0,name:"\u0412\u0441\u0435",ZonesTo:p.value[t.value.side]}),e});z("zonesFrom",y);const s=c(()=>{if(!y.value.length||!t.value.side)return[{id:0,name:"\u0412\u0441\u0435"}];let e=[...y.value];return e=e.find(u=>u.id===t.value.zoneFromId),!e||!e.ZonesTo?[]:e.ZonesTo});z("zonesTo",s);const n=f(null);z("selectedPack",n);const $=f(null);z("selectedFresh",$);const Q=f([]),g=f([]),m=f([]);z("currencyPrices",m);const i=c(()=>{if(!Q.value.length)return[];let e=[...Q.value];return t.value.zoneFromId?e.filter(u=>u.zoneFromId===t.value.zoneFromId):e}),k=c(()=>{let e=[...i.value];return t.value.zoneToId?e.filter(u=>u.zoneToId===t.value.zoneToId):e});z("filteredPackList",k);const v=f(!1);z("loading",v);function R(){X.post(d+"api/options.php",{params:{method:"getZones"}}).then(e=>{var u,b,V,w,B,O,M;if(!((u=e==null?void 0:e.data)!=null&&u.result))throw new Error;p.value=(w=(V=(b=e==null?void 0:e.data)==null?void 0:b.data)==null?void 0:V.allZonesTo)!=null?w:[],_.value=(M=(O=(B=e==null?void 0:e.data)==null?void 0:B.data)==null?void 0:O.zonesFrom)!=null?M:[]}).catch(e=>{I.notify(Y(e,"\u041E\u0439! Zones \u041D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 :(")),y.value=[]})}function oe(){v.value=!0,X.post(d+"api/pack.php",{params:{method:"list",side:t.value.side,addProfit:!1}}).then(e=>{var u,b,V,w,B,O,M;if(!((u=e==null?void 0:e.data)!=null&&u.result))throw new Error;Q.value=(w=(V=(b=e==null?void 0:e.data)==null?void 0:b.data)==null?void 0:V.Packs)!=null?w:[],m.value=(M=(O=(B=e==null?void 0:e.data)==null?void 0:B.data)==null?void 0:O.currencyPrices)!=null?M:[]}).catch(e=>{progress.value=!1,I.notify(Y(e,"\u041E\u0439! Packs \u041D\u0435 \u0440\u0430\u0431\u043E\u0442\u0430\u0435\u0442 :(")),Q.value=[],g.value=[]}).finally(()=>{v.value=!1})}function re(){t.value.zoneFromId=n.value.zoneFromId,t.value.zoneToId=n.value.zoneToId,$.value=n.value.Freshness.FreshLvls[n.value.Freshness.bestLvl]}function ue(){n.value=null}function se(){if(!n.value)return;if(!t.value.zoneToId){n.value=null;return}const e=i.value.find(u=>u.itemId===n.value.itemId&&u.zoneToId===t.value.zoneToId);e&&(n.value=e)}function ie(){t.value.zoneFromId=0,t.value.zoneToId=0,n.value=null,oe()}c(()=>t.value.condition?n.value.Freshness.bestLvl:n.value.Freshness.worstLvl);const de=c(()=>$.value.percent),H=c(()=>Math.round(n.value.dbPrice/130*100)),ce=c(()=>t.value.siol&&n.value.currencyId===500?5:0),J=c(()=>H.value*(t.value.ratePercent/100)*(1+ce.value/100)),q=c(()=>{let e=J.value*(1+de.value/100);return e*=1.02,n.value.currencyId!==500&&(e/=100),Math.round(e)}),K=c(()=>{if(n.value.currencyId===500)return q.value;let e=q.value*m.value[n.value.currencyId].price*.9;return Math.round(e)}),ve=c(()=>K.value-props.pRoute.Pack.craftPrice);return c(()=>Math.round(ve.value/n.value.Pack.laborNeed)),ye(()=>t.value.zoneFromId,()=>{if(t.value.zoneFromId&&s.value)return t.value.zoneFromId===t.value.zoneToId&&(t.value.zoneToId=s.value[0].id),s.value.length===2&&(t.value.zoneToId=s.value[1].id),!0;t.value.zoneToId=0}),Ie(()=>{R()}),(e,u)=>(T(),ne("div",we,[a(W,{class:"packCard"},{default:l(()=>[a(A,null,{default:l(()=>[a(Ve,{onSelected:ie}),S("div",null,[a(Se,{onOnSelect:u[0]||(u[0]=b=>ue())}),a(be,{onOnSelect:u[1]||(u[1]=b=>se())})])]),_:1}),a(Pe,{"animation-speed":200,color:"green",indeterminate:o.value},null,8,["indeterminate"]),Z("",!0),a(A,null,{default:l(()=>[k.value.length?(T(),L(Te,{key:0,onOnSelect:re})):Z("",!0)]),_:1}),n.value?(T(),L(A,{key:1},{default:l(()=>[S("div",Be,[S("div",null,[a(ge,{modelValue:t.value.ratePercent,"onUpdate:modelValue":u[3]||(u[3]=b=>t.value.ratePercent=b),class:"Input",dense:"",style:{width:"9em",height:"max-content",margin:"0"},suffix:"%",borderless:"",type:"number",step:"5",max:"130",min:"50"},null,8,["modelValue"])]),a(Le)])]),_:1})):Z("",!0),n.value?(T(),L(A,{key:2},{default:l(()=>[a(ze,{siol:t.value.siol,ratePercent:t.value.ratePercent,freshPercent:$.value.percent,dbPrice:n.value.dbPrice,currencyId:n.value.currencyId,goldSalary:K.value,factoryPrice:J.value,flatSalary:H.value,finalSalary:q.value},null,8,["siol","ratePercent","freshPercent","dbPrice","currencyId","goldSalary","factoryPrice","flatSalary","finalSalary"])]),_:1})):Z("",!0)]),_:1}),a(W,{class:"packCard"},{default:l(()=>u[4]||(u[4]=[P("eee")])),_:1})]))}};var Me=E(Oe,[["__scopeId","data-v-2277d3b1"]]);const Ne={class:"WindowArea column"},Ae={class:"ItemArea"},nt={__name:"PackInfoPage",setup(N){return(I,d)=>(T(),ne("div",Ne,[d[0]||(d[0]=S("div",{style:{display:"flex","justify-content":"center"}},[S("h1",null,"\u041F\u0430\u043A\u0418\u043D\u0444\u043E")],-1)),S("div",Ae,[a(Me)])]))}};export{nt as default};
